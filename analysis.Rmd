---
title: "analysis"
author: "Daniel Ward"
date: "29/04/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Imports
```{r}
library(tidyverse)
library(patchwork)
theme_set(theme_bw())
```


## Read in results
```{r}
df = read_csv("results/general_performance.csv")
df = select(df, -X1)
df$algorithm[df$algorithm == "rula"] = "RULA"
df$algorithm[df$algorithm == "rwm"] = "RW-Metropolis"
df
```


## Run times
We can compare the run times of the two algorithms:
```{r}
ggplot(df, aes(y = run_time, x = task, col = algorithm)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  labs(y = "run time / s") +
  lims(y = c(0,2000))
ggsave("plots/run_times.png")
```
Simulations are s significant proportion of the run time. Next we consider a MVN example in julia to look at the cost (per MCMC iteration).

### Run time with number of summary statistics
```{r}
df_s_times = read_csv("results/mvn_times_sum_stats.csv")

df_s_times = df_s_times %>%
  pivot_longer(cols = c(rula_time_per_step, rwm_time_per_step),
               names_to = "Algorithm", values_to = "Time (seconds/step)") %>%
  rename("Number of summary statistics" = n_sum_stats)

df_s_times$Algorithm[df_s_times$Algorithm == "rula_time_per_step"] = "RULA"
df_s_times$Algorithm[df_s_times$Algorithm == "rwm_time_per_step"] = "RWM"

p1 = df_s_times %>%
  ggplot(aes(x = `Number of summary statistics`,
             y = `Time (seconds/step)`, col = Algorithm)) +
  geom_point() +
  geom_line() +
  theme(legend.position = "none")

```


### Run time with number of parameters
```{r}
df_theta_times = read_csv("results/mvn_times_parameters.csv")

df_theta_times
df_theta_times = df_theta_times %>%
  pivot_longer(cols = c(rula_time_per_step, rwm_time_per_step),
               names_to = "Algorithm", values_to = "Time (seconds/step)") %>%
  rename("Number of paramters" = n_parameters)

df_theta_times$Algorithm[df_theta_times$Algorithm == "rula_time_per_step"] = "RULA"
df_theta_times$Algorithm[df_theta_times$Algorithm == "rwm_time_per_step"] = "RWM"

p2 = df_theta_times %>%
  ggplot(aes(x = `Number of paramters`,
             y = `Time (seconds/step)`, col = Algorithm)) +
  geom_line() +
  geom_point() +
  labs(y = "")

```

```{r}
p1 + p2
ggsave("plots/run_times_mvn_example.png", width = 7, height = 4)
```

## Effective sample sizes
We can compare the effective sample sizes of the two algorithms. The lines show
the max and min.

```{r}
ggplot(df, aes(x = task, y = mean_ess, col = algorithm)) +
  geom_point() +
  geom_pointrange(aes(ymin = min_ess, ymax = max_ess), alpha = 0.5) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ylab("mean ESS")
ggsave("plots/ess.png")
```

## Classification accuracy
```{r}
df %>%
  pivot_longer(cols = c(c2st_all, c2st_thinned), names_to = "thinned", values_to = "c2st") %>%
  mutate(thinned = case_when(
    thinned == "c2st_thinned" ~ "Thinned",
    thinned == "c2st_all" ~ "All samples"
    )) %>%
  ggplot(aes(x = task, y = c2st, col = algorithm), names_to = c("l")) +
  facet_wrap(~thinned) +
  geom_point() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  lims(y = c(0.5,1))
ggsave("plots/c2st.png")
```


## Acceptance probabilities
```{r}
df %>%
  filter(algorithm == "RW-Metropolis") %>%
  ggplot(aes(x = task, y = acceptance_rate)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  lims(y = c(0, 0.6))

ggsave("plots/acceptance_rates.png")
```

